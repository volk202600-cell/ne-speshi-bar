const MENU={categories:[{id:'mains',name:'–ì–∞—Ä—è—á—ñ –ø–æ–∑–∏—Ü—ñ—ó',items:[{id:'i1',name:'–ú—ñ–¥—ñ—ó —É –≤–µ—Ä—à–∫–æ–≤–æ–º—É —Å–æ—É—Å—ñ –∑ —á—ñ–∞–±–∞—Ç–æ—é',description:'–ù—ñ–∂–Ω—ñ –º—ñ–¥—ñ—ó —É –≤–µ—Ä—à–∫–æ–≤–æ–º—É —Å–æ—É—Å—ñ, –ø–æ–¥–∞—é—Ç—å—Å—è –∑ —á—ñ–∞–±–∞—Ç–æ—é.',price:330,img:'images/midii.jpg'},{id:'i2',name:'–°—Ç–µ–π–∫ –∑—ñ —Å–≤–∏–Ω–∏–Ω–∏',description:'–°–æ–∫–æ–≤–∏—Ç–∏–π —Å—Ç–µ–π–∫ –∑—ñ —Å–≤–∏–Ω–∏–Ω–∏ ‚Äî —Ü—ñ–Ω–∞ –∑–∞ 100 –≥.',price:200,img:'images/svynyna.jpg'},{id:'i3',name:'–°—Ç–µ–π–∫ Cowboy',description:'–ö–ª–∞—Å–∏—á–Ω–∏–π Cowboy ‚Äî —Ü—ñ–Ω–∞ –∑–∞ 100 –≥.',price:220,img:'images/cowboy.jpg'},{id:'i4',name:'–°—Ç–µ–π–∫ Ribeye',description:'Ribeye ‚Äî –Ω—ñ–∂–Ω–∏–π –º–∞—Ä–º—É—Ä–æ–≤–∏–π —Å—Ç–µ–π–∫, —Ü—ñ–Ω–∞ –∑–∞ 100 –≥.',price:280,img:'images/ribeye.jpg'}]}]};const DELIVERY_PER_3KM=60;const DELIVERY_UNIT_KM=3;const BAR_ADDRESS="–ö—Ä–æ–ø–∏–≤–Ω–∏—Ü—å–∫–∏–π, –¢–µ–∞—Ç—Ä–∞–ª—å–Ω–∞ 28";const state={menu:MENU,cart:[]};function fmtPrice(p){return p+" ‚Ç¥"}function calcDeliveryCost(km){const n=Math.ceil(km/DELIVERY_UNIT_KM);return n*DELIVERY_PER_3KM}function renderMenu(){const col=document.getElementById('menu-column');col.innerHTML='';state.menu.categories.forEach(cat=>{const box=document.createElement('div');box.className='menu-cat';const h=document.createElement('h2');h.innerText=cat.name;box.appendChild(h);cat.items.forEach(it=>{const item=document.createElement('div');item.className='item card';const img=document.createElement('img');img.src=it.img;img.alt=it.name;img.onclick=()=>openModal(it.img);const left=document.createElement('div');left.className='left';const title=document.createElement('div');title.className='title';title.innerText=it.name;const desc=document.createElement('div');desc.className='desc';desc.innerText=it.description;const price=document.createElement('div');price.className='price';price.innerText=fmtPrice(it.price);const btn=document.createElement('button');btn.className='btn';btn.innerText='–î–æ–¥–∞—Ç–∏';btn.onclick=()=>addToCart(it);left.appendChild(title);left.appendChild(desc);left.appendChild(price);left.appendChild(btn);item.appendChild(img);item.appendChild(left);box.appendChild(item)});col.appendChild(box)})}function addToCart(it){const ex=state.cart.find(c=>c.id===it.id);if(ex)ex.qty+=1;else state.cart.push({...it,qty:1});renderCart()}function renderCart(){const list=document.getElementById('cart-list');list.innerHTML='';if(state.cart.length===0){list.innerHTML='<div class="muted">–ö–æ—à–∏–∫ –ø–æ—Ä–æ–∂–Ω—ñ–π</div>';updateTotals();return}state.cart.forEach(ci=>{const div=document.createElement('div');div.className='cart-item';div.innerHTML=`<div>${ci.name} √ó ${ci.qty}</div><div><span>${ci.price*ci.qty} ‚Ç¥</span><button data-id="${ci.id}" class="inc">+</button><button data-id="${ci.id}" class="dec">-</button></div>`;list.appendChild(div)});document.querySelectorAll('.inc').forEach(b=>b.addEventListener('click',()=>changeQty(b.getAttribute('data-id'),1)));document.querySelectorAll('.dec').forEach(b=>b.addEventListener('click',()=>changeQty(b.getAttribute('data-id'),-1)));updateTotals()}function changeQty(id,delta){state.cart=state.cart.map(c=>c.id===id?{...c,qty:Math.max(0,c.qty+delta)}:c).filter(c=>c.qty>0);renderCart()}function updateTotals(){const subtotal=state.cart.reduce((s,i)=>s+i.price*i.qty,0);const km=parseFloat(document.getElementById('distance').value)||0;const delivery=calcDeliveryCost(km);document.getElementById('delivery-cost').innerText=delivery+' ‚Ç¥';document.getElementById('total').innerText=(subtotal+delivery)+' ‚Ç¥';document.getElementById('cart-count').innerText='üõí '+state.cart.reduce((s,i)=>s+i.qty,0)}document.getElementById('distance').addEventListener('input',updateTotals);document.getElementById('confirm-btn').addEventListener('click',()=>{if(state.cart.length===0){document.getElementById('feedback').innerText='–ö–æ—à–∏–∫ –ø–æ—Ä–æ–∂–Ω—ñ–π';return}document.getElementById('payment-choice').style.display='block'});document.getElementById('finalize-btn').addEventListener('click',async()=>{const pay=document.querySelector('input[name="pay"]:checked').value;const name=document.getElementById('name').value.trim();const phone=document.getElementById('phone').value.trim();const address=document.getElementById('address').value.trim();const km=parseFloat(document.getElementById('distance').value)||0;if(!name||!phone){document.getElementById('feedback').innerText='–í–∫–∞–∂—ñ—Ç—å —ñ–º\'—è —Ç–∞ —Ç–µ–ª–µ—Ñ–æ–Ω';return}const subtotal=state.cart.reduce((s,i)=>s+i.price*i.qty,0);const delivery=calcDeliveryCost(km);const total=subtotal+delivery;const payload={customer:{name,phone,address},items:state.cart,subtotal,delivery,total,payment_method:pay,bar_address:BAR_ADDRESS};try{const res=await fetch('/api/order',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)});const data=await res.json();if(data.ok){document.getElementById('feedback').innerHTML='<div style="color:#4ade80;font-weight:700">–î—è–∫—É—î–º–æ! –ó –≤–∞–º–∏ –∑–≤\'—è–∂–µ—Ç—å—Å—è –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä –¥–ª—è —É—Ç–æ—á–Ω–µ–Ω–Ω—è –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è.</div>';state.cart=[];renderCart();document.getElementById('name').value='';document.getElementById('phone').value='';document.getElementById('address').value='';document.getElementById('distance').value='';document.getElementById('payment-choice').style.display='none'}else{document.getElementById('feedback').innerText='–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω–Ω—ñ.'}}catch(err){console.error(err);document.getElementById('feedback').innerText='–ü–æ–º–∏–ª–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞.'}});function openModal(src){const modal=document.getElementById('modal');document.getElementById('modal-img').src=src;modal.style.display='flex'}function closeModal(e){if(e&&e.target&&e.target.id==='modal')return modalHide();modalHide()}function modalHide(){document.getElementById('modal').style.display='none';document.getElementById('modal-img').src=''}window.addEventListener('load',()=>{renderMenu();renderCart();updateTotals()});